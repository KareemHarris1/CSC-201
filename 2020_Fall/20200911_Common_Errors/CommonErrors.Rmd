---
title: "Common Errors"
author: "D. Howell"
date: "9/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

>At the source of every error which is blamed on the computer you will find at least two human errors, including the error of blaming it on the computer. - Tom Gilb

>There are two ways to write error-free programs; only the third works. - Alan Perlis

I often tell beginning programmers (at work or in this course) that your ultimate goal in writing a program shouldn't be to get the program to work, but to not physically destroy your computer out of rage. Programming is notoriously unforgiving because a program either runs perfectly well or not at all. But the payoff of programming usually wins out. Copmuters are better at certain things than humans are (like exploring data and building statistical models), and they can save us a lot of time (especially when you automate them). 

So far in the class, you haven't seen me make a lot of errors. That's because I've already debugged the scripts before class, not because I never made them. In this lesson, however, I will make a bunch of errors and we will debug them together. Hopefully this will help you prepare for your first lab writing in R. 

## Errors in R
One of the metrics by which people judge the validity of a progamming language is by how helpful its error messages are. R is generally thought to have good error messages. The most common error messages I get from R (especially as I was beginning to learn the language) are laid in this section. 

NOTE: In this lesson, we use the try() function, which you can wrap around any command (or set of commands). You won't have to use this function in class, but I use it here because it allows a program to continue even if the command inside the try() throws an error. Otherwise, the program would crash at the first error it finds.

### Common "pre-error" mistakes
I included this section to talk about things beginners do that don't result in an error from R, but are defninitely mistakes. 

* mismatching parentheses
  + Sometimes if you have a larger command with several functions, you can lose track of where the parentheses need to go. This most often results in no output from the command, but instead of the usual ">" that you see after executing a command, you see a "+", which is R's way of telling you that it doesn't think you've finished your command yet because you didn't close off all the brackets and parentheses.
```{r message=F, warning=F}
try(
  print(rep('nice', 25))
)
try(
  print(rep('nice'), 25)
)
# try(
#   print(rep('nice'), 25))
# )
# try(
#   print(rep('nice', 25)
# )
```



* executing code from a script out of order
  + Consider that you have this script pulled up in the script window of RStudio
```{r message=F, warning=F}
library(ggplot2)

df <- mtcars

# plot mpg against hp
ggplot(df) + 
  geom_point(aes(x = hp, y = mpg))

# remove hp column
df <- df[,-4]

```
  + After running the script top to bottom, you may want to see the scatter plot again, so you go up to that line and execute it, only to find an error... it's because the most recent version of the df object you made took out one of the columns that your ggplot command is trying to plot. 

### ‘could not find function’
This is easily the most common error message you will see starting out. But the good thing is, it's one of the easiest to solve. There are two reasons this error usually occurs...

 * You forgot to load the package that has the function you want to use. Let's try to use %>% and filter() without loading dplyr.
```{r}
# trying to create a column called six_cylinder_TF that returns TRUE when the cyl column has a value of 6 and FALSE when it does not
try(
mutate(
  mtcars, 
  six_cylinder_TF = cyl==6
  )
)
```

```{r message=F, warning=F}
library(dplyr)
try(
  mutate(
  mtcars, 
  six_cylinder_TF = cyl==6
  )
)
```

  * You misspelled the function or got the case wrong.
```{r message=F, warning=F}
try(
  mtuate(
  mtcars, 
  six_cylinder_TF = cyl==6
  )
)

try(
  Mutate(
  mtcars, 
  six_cylinder_TF = cyl==6
  )
)

```

### ‘object not found’
This error happens when you call an object in a command, but R doesn't have an object with that name in memory. 

```{r message=F, warning=F}
# make a copy of the mtcars data set in an object names 'mydata'
mydata <- mtcars

# try to print the first six rows of the object you just created
try(
  head(mydat)
)
# oops.

try(
  head(MyData)
)
# nope

try(
  head(mydata)
)
# nailed it
```

### : there is no package called 'blahblah'
This one is pretty easy, but it can happen often. 
```{r message=F, warning=F}
try(
  library(bestPackageEver)
)
```
You just need to install the package first, and then try to load it. 

### Indexing Errors
Indexing errors happen when you call a row or column of a data frame that the data frame doesn't have.

```{r message=F, warning=F}
# how many rows does mtcars have?
nrow(mtcars)

# how many columns?
ncol(mtcars)

# let's try to get the 29th row and all the columns
df <- data.frame(mtcars)
try(
  df[29,]
)

#  let's try to get the 15th column and all the rows
try(
  df[,15]
)

# let's try to get the 25th through the 40th values of the cyl column
try(
  df$cyl[25:40]
)

# let's get the 10th value in the hp column
try(
  df$hp[10,]
)

try(
  df$hp[10]
)


```

### ‘non-numeric argument to a binary operator’
This error happens when you try to perform a mathematical operation on an object that doesn't allow it. 

```{r message=F, warning=F}
try(
  1 + 1
)
try(
'one' + 1
)
class(1)
class('one')

yesterday <- '2020-09-10'
try(
  yesterday + 1
)
class(yesterday)

yesterday <- as.Date('2020-09-10')
try(
  yesterday + 1
)
class(yesterday)
```

### 'replacement has'
This error usually happens when you try to add a column to a data frame, but the lengths don't match up. 
```{r message=F, warning=F}

# let's make a row number column for our copy of mtcars
df <- mtcars
nrow(df)

try(
  df$row_number <- 1:30
)

try(
  df$row_number <- 1:32
)
# or an even better way to do it
try(
  df$row_number <- 1:nrow(df)
)

# or let's take the iris data set and put one of its columns onto the mtcars data
df1 <- mtcars
df2 <- iris

try(
  df1$sepal_length <- df2$Sepal.Length
)
try(
  df1$sepal_length <- df2$Sepal.Length[1:nrow(df1)]
)
summary(df1)

```


## Honorable Mentions
There are some more common errors that happen when performing operations that we haven't covered in class yet. We will cover these later. 

* ‘: cannot open the connection’
  + Generally happens when you try to read data into an R session but you get the path wrong. 

```{r message=F, warning=F}

```

* ‘Error in if’
  + Happens when the logic you put inside an if statement does not return a boolean value (TRUE or FALSE). Most of the time this happens to me, it's because the logic I put in the if statement returns NA. 
```{r message=F, warning=F}

```

## Debugging
The process of finding/diagnosing the errors in your code and solving them is called "debugging" (an error in some code is colloquially referred to as a "bug"). Most programmers think debugging is at least twice as hard as writing code because you switch from putting your ideas into the computer to attempting to read your ideas from the perspective of the computer. 

When a program that I wrote inevitably crashes, I usually take the following steps:

* The first thing I do is start from the top of the program and execute one line at a time until I get to the line that causes the error. 
* Check the line for syntax mistakes like a missing parenthesis 
* If that all looks correct, then I talk myself through what I want the command to do
* If no luck after that, google it. :)

>Another effective technique is to explain your code to someone else. This will often cause you to explain the bug to yourself. Sometimes it takes no more than a few sentences, followed by an embarrassed “Never mind, I see what's wrong. Sorry to bother you.” This works remarkably well; you can even use non-programmers as listeners. One university computer center kept a teddy bear near the help desk. Students with mysterious bugs were required to explain them to the bear before they could speak to a human counselor.
